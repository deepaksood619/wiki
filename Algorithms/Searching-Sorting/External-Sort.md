# External Sort

Created: 2018-03-24 13:50:26 +0500

Modified: 2018-09-27 12:48:52 +0500

---

![External Sorting One method for sorting a file is to load the file into memory, sort the data in memory, then write the results. When the file cannot be loaded into memory due to resource limitations, an external sort applicable. We will implement an external sort using replacement selection to establish initial runs, followed by a polyphase merge sort to merge the runs into one sorted file. I highly recommend you consult Knuth (19981, as many details have been omitted. Theory For clarity, I'll assume that data is on one or more reels of magnetic tape. Figure 4-1 illustrates a 3-way polyphase merge. Initially, in phase A, all data is on tapes Tl and T2. Assume that the ](media/External-Sort-image1.png)



![beginning of each tape is at the of the frame. There are wo sequential runs of data on T I: 4-8, 6-Z T2 hag one run: 5-9 At phage B. we'æ first mn frcm tapes Tl (4- 8) and T2 (5•9) into a longer run on tape 13 Phase C is simply renames the tapes. so we may repeat the mer* In *age O we the merge. with the Outgwt on TX phase Tl 12 T3 Figure 4-1: Merge Sort Several Interesting details have been omitted from the previous "lustration. For example, how were the initial runs created? And. did notice that they merged perfectly. no extra runs on any tapes? Before explain the method used for Wtial rung, me digress for a bit In 1202. Fibonacci presented the exercise in his Abbaci (300k Of the Abacus); "How many pairs of rabbits can be prc•duræd from a single pair in a years timer We may that each pair a new pair of each pair becomes fertile at the age o' one month. and that rabbits never die, After one month. there will be 2 pairs of rabbits; after months there will be 3; month the CYiginal pair and the pair during the first month rx:flh usher in a new pair. and there will be 5 in all; and so on. This series. where each number ig the Sum Of the preceeding numbers. ig ag the F230naCCi CurZuSly. the Fibonacci Series hag found wide-spread to everythng from the arrangement of flæ.ers on plants studying the efficiency of Eudiffs algorithm. There's even a Fibonacci Quarterly jownal_ And, as rnÉht suspect. the Fibonacci Series hag to do with establishing initial runs for external sorts, Recall that we initially ha,d one run on tape T2. and 2 runs on tape T'. Note that the numbers (1.2) are Seqmtial in FitmaCCi Series After first one run on Tl and one run on 12. Note that the {1.1) are two sequential numbers in the Fibonacci series. Oruy notch We Could predict. fact, that if we had 13 runs T2, and 21 rung on Tl {13.21}. we would be left with 8 runs on TI and 13 runs on T3 {8.13} after one pass. Successive paggeS in mn Of {5.8}, {3.5}, {2.3}. (1 {0.1}, total 7 This arrangement is ideal. and will result in the minimum number of passes. Should data actually on tape, this is a big gavingS, as must and rewourud for each *ss. Fcy more than 2 tapes, higher-order Fitnnacci numbers are used. ](media/External-Sort-image2.png)

![Initially, al the data on onetape The ig read, rung are distributed to Other tapes in the system, After the initial runs are created. thew are merged as descrit"2d abme. One method we couE use to create initial mnS ig to read a batch Of into gcYt the Mite them out. This procæss would continue until we had exhausted the input tape, An algwithrn, for longer rune A is in memory to act a holding place for several "Words, Initially. the buffer is filled. Then. the following steps are repeated until the is exhausted: Select the record with the smallest key that is the key ot the last record written If all keys Smaller than the key Of the Last record then we have reached end of a run, Select the record with the smallest key for the first record of the next run. Write the selected record. the Selected record with a new Input. Figure illustrates replacement selection for a small Me. To keep things simple, I've aJm:ated a 2•record buffer, Typically. such a butter would hold thousands of reoords, We load the buffer in step B. and write the record with the smallest key (6) in step C This is replaræd the next record (key 8). We Select the gmallegt key >= 6 in Step O. T his is key 7. After witing key 7. we it with key 4, This process repeats until step F. mere our last key written was 8. and all keys are less than At this we terminate the run, and Start another Butter 5-34-8-6-7 5-34-8 +3-4 6-7 6.7.8 6-7-8 3-4 34. s 4-2: Replacement Selection This Strategy Simply utilizes an buffer to hold values until the time for output using random numbers as input. the average length Ota run is twice the length ofthe buffer. if data is ordered. rung Can be extr*neåy Thug. this method ig more effective than doing partial sorts. When selecting the next output rectyd. we need to find the smallest key the last key written. One way to do this ig to the entire list, Searching for the apnpriate ke» However, when the buffer holds thousands ot records. execution time be-comes prohibitive, An alternative method is to use a birWy tree Structure, so that we only Compare lg n items. Implementation in C An Of an external sort is included. Function makeRuns calls readRec to read the Function readReC selætZn (utilizing a binary tree) to fetch the next record. and makeRuns distributes the rernrds in a Fibonacci distributioru If the Of rung ig not a are SimLAated at the beginning of each file. Function mergeSort is then called do a polyphase merge sort on the Implementation in Visual Basic ](media/External-Sort-image3.png)



**Unix External Sort**

Unix Sort uses an External R-Way merge sorting algorithm. It divides the input up into smaller portions (that fit into memory) and then merges each portion together at the end.



